<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animaux</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
  <div class="container text-center">
  <h1 class="mt-3 mb-3">Liste des Animaux</h1>

  <!-- Tableau pour afficher les animaux -->
  <table class="table table-bordered border-primary" border="1">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Taille</th>
        <th>Poids</th>
        <th>Force de Morsure</th>
        <th>Force</th>
        <th>Régime Alimentaire</th>
        <th>Vitesse</th>
        <th>Intelligence</th>
        <th>Action</th>
      </tr>
    </thead>
  </div>
    <tbody id="animalTable" >
      <!-- Ici seront affichés les animaux -->
    </tbody>
  
  </table>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap');

*, *:after, *:before {
	box-sizing: border-box;
}

body {
	font-family: "DM Sans", sans-serif;
	line-height: 1.5;
	background-color: #f1f3fb;
	padding: 0 2rem;
}

img {
	max-width: 100%;
	display: block;
}



input {
	appearance: none;
	border-radius: 0;
}

.card {
	margin: 2rem auto;
	display: flex;
	flex-direction: column;
	width: 100%;
	max-width: 425px;
	background-color: #FFF;
	border-radius: 10px;
	box-shadow: 0 10px 20px 0 rgba(#999, .25);
	padding: .75rem;
}

.card-image {
	border-radius: 8px;
	overflow: hidden;
	padding-bottom: 65%;
	background-image: url('https://www.wwf.fr/sites/default/files/styles/page_cover_large_16_9/public/2017-05/279168-min.jpg?h=818ea07f&itok=vF2ILljB');
	background-repeat: no-repeat;
	background-size: 150%;
	background-position: 0 5%;
	position: relative;
}

.card-heading {
	position: absolute;
	left: 10%;
	top: 15%;
	right: 10%;
	font-size: 1.75rem;
	font-weight: 700;
	color: #735400;
	line-height: 1.222;
	small {
		display: block;
		font-size: .75em;
		font-weight: 400;
		margin-top: .25em;
	}
}

.card-form {
	padding: 2rem 1rem 0;
}

.input {
	display: flex;
	flex-direction: column-reverse;
	position: relative;
	padding-top: 1.5rem;
	&+.input {
		margin-top: 1.5rem;
	}
}

.input-label {
	color: #8597a3;
	position: absolute;
	top: 1.5rem;
	transition: .25s ease;
}

.input-field {
	border: 0;
	z-index: 1;
	background-color: transparent;
	border-bottom: 2px solid #eee; 
	font: inherit;
	font-size: 1.125rem;
	padding: .25rem 0;
	&:focus, &:valid {
		outline: 0;
		border-bottom-color: #6658d3;
		&+.input-label {
			color: #6658d3;
			transform: translateY(-1.5rem);
		}
	}
}

.action {
	margin-top: 2rem;
}

.action-button {
	font: inherit;
	font-size: 1.25rem;
	padding: 1em;
	width: 100%;
	font-weight: 500;
	background-color: #6658d3;
	border-radius: 6px;
	color: #FFF;
	border: 0;
	&:focus {
		outline: 0;
	}
}

.card-info {
	padding: 1rem 1rem;
	text-align: center;
	font-size: .875rem;
	color: #8597a3;
	a {
		display: block;
		color: #6658d3;
		text-decoration: none;
	}
}

  </style>
  <div class="container d-flex justify-content-center">

  
  <div class="card">
		<div class="card-image">	
			<h2 class="text-light card-heading">
				Ajoutez l'animal
				<small>et ses caractéristiques </small>
			</h2>
		</div>
		<form  id="addAnimalForm" class="card-form">
			<div class="input">
				<input type="text" class="input-field" id="nom" name="nom"  required/>
				<label class="input-label">Nom</label>
			</div>
						<div class="input">
				<input id="taille" name="taille" type="text" class="input-field"  required/>
				<label class="input-label">Taille</label>
			</div>
						<div class="input">
				<input id="poids" name="poids" type="number" class="input-field" required/>
				<label class="input-label">Poids</label>
			</div>
      <div class="input">
				<input id="forceMorsure" name="forceMorsure" type="number" class="input-field" required/>
				<label class="input-label">Force de morsure</label>
			</div>
      <div class="input">
				<input id="force" name="force" type="number" class="input-field" required/>
				<label class="input-label">Force</label>
			</div>
    
      <div class="input">
				<input id="regimeAlimentaire" name="regimeAlimentaire" type="text"  class="input-field" required/>
				<label class="input-label">Régime Alimentaire</label>
			</div>
      <div class="input">
				<input id="vitesse" name="vitesse"  type="text"  class="input-field" required/>
				<label class="input-label">Vitesse</label>
			</div>
      <div class="input">
				<input id="intelligence" name="intelligence" type="text"  class="input-field" required/>
				<label class="input-label">Intelligence</label>
			</div>
			<div class="action">
				<button type="submit" class="action-button">Ajouter un animal</button>
			</div>
		</form>
		<div class="card-info">
			<p>En ajoutant un animal, tu enrichis le savoir <a href="#">universel</a></p>
		</div>
	</div>
  

 <div class="card">
		<div class="card-image">	
			<h2 class="text-light card-heading">
				Mettez à jour
				<small>les caractéristiques de l'animal</small>
			</h2>
		</div>
		<form  id="updateAnimalForm" class="card-form">
			<div class="input">
				<input type="text" class="input-field" id="nom" name="nom"  required/>
				<label class="input-label">Nom</label>
			</div>
						<div class="input">
				<input id="taille" name="taille" type="text" class="input-field"  required/>
				<label class="input-label">Taille</label>
			</div>
						<div class="input">
				<input id="poids" name="poids" type="number" class="input-field" required/>
				<label class="input-label">Poids</label>
			</div>
      <div class="input">
				<input id="forceMorsure" name="forceMorsure" type="number" class="input-field" required/>
				<label class="input-label">Force de morsure</label>
			</div>
      <div class="input">
				<input id="force" name="force" type="number" class="input-field" required/>
				<label class="input-label">Force</label>
			</div>
    
      <div class="input">
				<input id="regimeAlimentaire" name="regimeAlimentaire" type="text"  class="input-field" required/>
				<label class="input-label">Régime Alimentaire</label>
			</div>
      <div class="input">
				<input id="vitesse" name="vitesse"  type="text"  class="input-field" required/>
				<label class="input-label">Vitesse</label>
			</div>
      <div class="input">
				<input id="intelligence" name="intelligence" type="text"  class="input-field" required/>
				<label class="input-label">Intelligence</label>
			</div>
			<div class="action">
				<button type="submit" class="action-button">Mettre à jour</button>
			</div>
		</form>
		<div class="card-info">
			<p>En mettant à jour, tu altères des données <a href="#">non récupérables</a></p>
		</div>
	</div>
</div>
</div>
  <script>
    // Fonction pour afficher les animaux dans le tableau
    async function displayAnimals() {
      const response = await fetch('http://localhost:4000/animals');
      const animals = await response.json();

      const animalTable = document.getElementById('animalTable');
      animalTable.innerHTML = '';

      animals.forEach(animal => {
        const row = document.createElement('tr');
        row.innerHTML = `
        <td>${animal.nom}</td>
          <td>${animal.taille}</td>
          <td>${animal.poids}</td>
          <td>${animal.forceMorsure}</td>
          <td>${animal.force}</td>
          <td>${animal.regimeAlimentaire}</td>
          <td>${animal.vitesse}</td>
          <td>${animal.intelligence}</td>
          <td>
  <button type="button" class="btn btn-warning"onclick="updateAnimal('${animal._id}')">Mettre à jour</button>
  <button type="button" class="btn btn-danger"onclick="deleteAnimal('${animal._id}')">Supprimer</button>
</td>
        `;
        animalTable.appendChild(row);
      });
    }

    // Fonction pour ajouter un nouvel animal
    async function addAnimal(event) {
      event.preventDefault();

      const form = event.target;
      const formData = new FormData(form);

      const response = await fetch('http://localhost:4000/animals', {
        method: 'POST',
        body: JSON.stringify(Object.fromEntries(formData.entries())),
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        form.reset();
        displayAnimals();
      }
    }

    async function updateAnimal(id) {
  const response = await fetch(`/animals/${id}`);
  const animal = await response.json();

  const form = document.getElementById('updateAnimalForm');
  form.style.display = 'block'; // Afficher le formulaire

  // Remplir le formulaire avec les informations actuelles de l'animal
  form.elements['nom'].value = animal.nom;
  form.elements['taille'].value = animal.taille;
  form.elements['poids'].value = animal.poids;
  form.elements['forceMorsure'].value = animal.forceMorsure;
  form.elements['force'].value = animal.force;
  form.elements['regimeAlimentaire'].value = animal.regimeAlimentaire;
  form.elements['vitesse'].value = animal.vitesse;
  form.elements['intelligence'].value = animal.intelligence;
  // ...
  
  // Modifier l'événement de soumission du formulaire pour mettre à jour l'animal spécifique
  form.onsubmit = event => {
    event.preventDefault();
    const formData = new FormData(form);
    fetch(`/animals/${id}`, {
      method: 'PUT',
      body: JSON.stringify(Object.fromEntries(formData.entries())),
      headers: {
        'Content-Type': 'application/json'
      }
    }).then(response => {
      if (response.ok) {
        form.reset();
        form.style.display = 'none'; // Cacher le formulaire
        displayAnimals();
      }
    });
  };
}

    // Fonction pour supprimer un animal
    async function deleteAnimal(id) {
      const response = await fetch(`/animals/${id}`, {
        method: 'DELETE'
      });

      if (response.ok) {
        displayAnimals();
      }
    }

    // Événement de soumission du formulaire pour ajouter un animal
    document.getElementById('addAnimalForm').addEventListener('submit', addAnimal);

    // Au chargement de la page, afficher les animaux
    displayAnimals();
  </script>
</body>
</html>
